<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Pieces of Data Science</title><link href="https://byrony.github.io/" rel="alternate"></link><link href="https://byrony.github.io/feeds/misc.atom.xml" rel="self"></link><id>https://byrony.github.io/</id><updated>2016-09-06T00:00:00-04:00</updated><entry><title>"Titanic: A Tutorial to Achieve 0.82297"</title><link href="https://byrony.github.io/titanic-a-tutorial-to-achieve-082297.html" rel="alternate"></link><published>2016-09-06T00:00:00-04:00</published><updated>2016-09-06T00:00:00-04:00</updated><author><name>"Vincent Cao"</name></author><id>tag:byrony.github.io,2016-09-06:titanic-a-tutorial-to-achieve-082297.html</id><summary type="html">&lt;h4&gt;For the original Knitr version HTML file, see &lt;a href="http://rpubs.com/Vincent/Titanic"&gt;here&lt;/a&gt;. It looks like the plugin of Pelican doesn't support Rmd perfectly.&lt;/h4&gt;
&lt;h2&gt;1. Introduction&lt;/h2&gt;
&lt;p&gt;The sinking of Titanic in twentieth century is an sensational tragedy, in which 1502 out of 2224 passenger and crew members were killed. Kaggle provided this dataset to machine learning beginners to predict what sorts of people were more likely to survive given the information including sex, age, name, etc. Although the size of the dataset is small, it provides newbies a chance to accomplish most procedures in a data science project including data cleaning, feature engineering, model fitting, and tweaking to achieve higher scores.&lt;/p&gt;
&lt;h3&gt;1.1 Read the data&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;caret&lt;span class="p"&gt;)&lt;/span&gt;

readData &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kr"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;path.name&lt;span class="p"&gt;,&lt;/span&gt; file.name&lt;span class="p"&gt;,&lt;/span&gt; column.types&lt;span class="p"&gt;,&lt;/span&gt; missing.types&lt;span class="p"&gt;){&lt;/span&gt;
    read.csv&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kp"&gt;paste&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;path.name&lt;span class="p"&gt;,&lt;/span&gt; file.name&lt;span class="p"&gt;,&lt;/span&gt; sep&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; colClasses &lt;span class="o"&gt;=&lt;/span&gt; column.types&lt;span class="p"&gt;,&lt;/span&gt; na.strings &lt;span class="o"&gt;=&lt;/span&gt; missing.types &lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="c1"&gt;#Titanic.path &amp;lt;- &amp;#39;./data/&amp;#39;&lt;/span&gt;
Titanic.path &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;/Users/caoxiang/Dropbox/Titanic/data/&amp;#39;&lt;/span&gt;
train.file.name &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;train.csv&amp;#39;&lt;/span&gt;
test.file.name &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;test.csv&amp;#39;&lt;/span&gt;
missing.types &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kt"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;NA&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
train.column.types &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kt"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;integer&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;   &lt;span class="c1"&gt;# PassengerId&lt;/span&gt;
                        &lt;span class="s"&gt;&amp;#39;factor&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;    &lt;span class="c1"&gt;# Survived &lt;/span&gt;
                        &lt;span class="s"&gt;&amp;#39;factor&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;    &lt;span class="c1"&gt;# Pclass&lt;/span&gt;
                        &lt;span class="s"&gt;&amp;#39;character&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="c1"&gt;# Name&lt;/span&gt;
                        &lt;span class="s"&gt;&amp;#39;factor&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;    &lt;span class="c1"&gt;# Sex&lt;/span&gt;
                        &lt;span class="s"&gt;&amp;#39;numeric&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;   &lt;span class="c1"&gt;# Age&lt;/span&gt;
                        &lt;span class="s"&gt;&amp;#39;integer&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;   &lt;span class="c1"&gt;# SibSp&lt;/span&gt;
                        &lt;span class="s"&gt;&amp;#39;integer&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;   &lt;span class="c1"&gt;# Parch&lt;/span&gt;
                        &lt;span class="s"&gt;&amp;#39;character&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="c1"&gt;# Ticket&lt;/span&gt;
                        &lt;span class="s"&gt;&amp;#39;numeric&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;   &lt;span class="c1"&gt;# Fare&lt;/span&gt;
                        &lt;span class="s"&gt;&amp;#39;character&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="c1"&gt;# Cabin&lt;/span&gt;
                        &lt;span class="s"&gt;&amp;#39;factor&amp;#39;&lt;/span&gt;     &lt;span class="c1"&gt;# Embarked&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
test.column.types &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; train.column.types&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="m"&gt;-2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

train &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; readData&lt;span class="p"&gt;(&lt;/span&gt;Titanic.path&lt;span class="p"&gt;,&lt;/span&gt; train.file.name&lt;span class="p"&gt;,&lt;/span&gt; train.column.types&lt;span class="p"&gt;,&lt;/span&gt; missing.types&lt;span class="p"&gt;)&lt;/span&gt;
test &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; readData&lt;span class="p"&gt;(&lt;/span&gt;Titanic.path&lt;span class="p"&gt;,&lt;/span&gt; test.file.name&lt;span class="p"&gt;,&lt;/span&gt; test.column.types&lt;span class="p"&gt;,&lt;/span&gt; missing.types&lt;span class="p"&gt;)&lt;/span&gt;
test&lt;span class="o"&gt;$&lt;/span&gt;Survived &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kc"&gt;NA&lt;/span&gt; &lt;span class="c1"&gt;# add Survived column to test dataset and fill it out with NA.&lt;/span&gt;

combi &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kp"&gt;rbind&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;train&lt;span class="p"&gt;,&lt;/span&gt; test&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# combine training and test set for further manipulation&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;2. Exploratory Data Analysis&lt;/h2&gt;
&lt;h3&gt;2.1 Check the structure of the dataset&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;str&lt;span class="p"&gt;(&lt;/span&gt;train&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;## &amp;#39;data.frame&amp;#39;:    891 obs. of  12 variables:
##  $ PassengerId: int  1 2 3 4 5 6 7 8 9 10 ...
##  $ Survived   : Factor w/ 2 levels &amp;quot;0&amp;quot;,&amp;quot;1&amp;quot;: 1 2 2 2 1 1 1 1 2 2 ...
##  $ Pclass     : Factor w/ 3 levels &amp;quot;1&amp;quot;,&amp;quot;2&amp;quot;,&amp;quot;3&amp;quot;: 3 1 3 1 3 3 1 3 3 2 ...
##  $ Name       : chr  &amp;quot;Braund, Mr. Owen Harris&amp;quot; &amp;quot;Cumings, Mrs. John Bradley (Florence Briggs Thayer)&amp;quot; &amp;quot;Heikkinen, Miss. Laina&amp;quot; &amp;quot;Futrelle, Mrs. Jacques Heath (Lily May Peel)&amp;quot; ...
##  $ Sex        : Factor w/ 2 levels &amp;quot;female&amp;quot;,&amp;quot;male&amp;quot;: 2 1 1 1 2 2 2 2 1 1 ...
##  $ Age        : num  22 38 26 35 35 NA 54 2 27 14 ...
##  $ SibSp      : int  1 1 0 1 0 0 0 3 0 1 ...
##  $ Parch      : int  0 0 0 0 0 0 0 1 2 0 ...
##  $ Ticket     : chr  &amp;quot;A/5 21171&amp;quot; &amp;quot;PC 17599&amp;quot; &amp;quot;STON/O2. 3101282&amp;quot; &amp;quot;113803&amp;quot; ...
##  $ Fare       : num  7.25 71.28 7.92 53.1 8.05 ...
##  $ Cabin      : chr  NA &amp;quot;C85&amp;quot; NA &amp;quot;C123&amp;quot; ...
##  $ Embarked   : Factor w/ 3 levels &amp;quot;C&amp;quot;,&amp;quot;Q&amp;quot;,&amp;quot;S&amp;quot;: 3 1 3 3 3 2 3 3 3 1 ...
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kp"&gt;summary&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;train&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;##   PassengerId    Survived Pclass      Name               Sex     
##  Min.   :  1.0   0:549    1:216   Length:891         female:314  
##  1st Qu.:223.5   1:342    2:184   Class :character   male  :577  
##  Median :446.0            3:491   Mode  :character               
##  Mean   :446.0                                                   
##  3rd Qu.:668.5                                                   
##  Max.   :891.0                                                   
##                                                                  
##       Age            SibSp           Parch           Ticket         
##  Min.   : 0.42   Min.   :0.000   Min.   :0.0000   Length:891        
##  1st Qu.:20.12   1st Qu.:0.000   1st Qu.:0.0000   Class :character  
##  Median :28.00   Median :0.000   Median :0.0000   Mode  :character  
##  Mean   :29.70   Mean   :0.523   Mean   :0.3816                     
##  3rd Qu.:38.00   3rd Qu.:1.000   3rd Qu.:0.0000                     
##  Max.   :80.00   Max.   :8.000   Max.   :6.0000                     
##  NA&amp;#39;s   :177                                                        
##       Fare           Cabin           Embarked  
##  Min.   :  0.00   Length:891         C   :168  
##  1st Qu.:  7.91   Class :character   Q   : 77  
##  Median : 14.45   Mode  :character   S   :644  
##  Mean   : 32.20                      NA&amp;#39;s:  2  
##  3rd Qu.: 31.00                                
##  Max.   :512.33                                
## 
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;2.2 Visualize the relationship between features and response&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Check the relation between &lt;code&gt;Sex&lt;/code&gt; and &lt;code&gt;Survived&lt;/code&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Consistent with our prior, the female is more likely to survive.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;ggplot2&lt;span class="p"&gt;)&lt;/span&gt;
p &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; ggplot&lt;span class="p"&gt;(&lt;/span&gt;train&lt;span class="p"&gt;,&lt;/span&gt; aes&lt;span class="p"&gt;(&lt;/span&gt;x&lt;span class="o"&gt;=&lt;/span&gt;Survived&lt;span class="p"&gt;,&lt;/span&gt; fill&lt;span class="o"&gt;=&lt;/span&gt;Sex&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; geom_bar&lt;span class="p"&gt;(&lt;/span&gt;color&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;black&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
p
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="plot of chunk Titanic-3" src="{filename}/figure/Titanic-3-1.png" /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Check the relation between &lt;code&gt;Age&lt;/code&gt; and &lt;code&gt;Survive&lt;/code&gt;&lt;/strong&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;As there are many missing value in &lt;code&gt;Age&lt;/code&gt; column, we omitted these rows before plotting. It looks like children are more likely to survive.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# show histogram&lt;/span&gt;
&lt;span class="c1"&gt;# p3 &amp;lt;- ggplot(train[!is.na(train$Age), ], aes(x=Age, fill=Survived)) + geom_histogram()&lt;/span&gt;
&lt;span class="c1"&gt;# show density plot&lt;/span&gt;
p2 &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; ggplot&lt;span class="p"&gt;(&lt;/span&gt;train&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="kp"&gt;which&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kp"&gt;is.na&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;train&lt;span class="o"&gt;$&lt;/span&gt;Age&lt;span class="p"&gt;)),&lt;/span&gt; &lt;span class="p"&gt;],&lt;/span&gt; aes&lt;span class="p"&gt;(&lt;/span&gt;x&lt;span class="o"&gt;=&lt;/span&gt;Age&lt;span class="p"&gt;,&lt;/span&gt; fill&lt;span class="o"&gt;=&lt;/span&gt;Survived&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; geom_density&lt;span class="p"&gt;(&lt;/span&gt;alpha&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0.6&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; 
    facet_grid&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;.&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;Sex&lt;span class="p"&gt;)&lt;/span&gt;

p2
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="plot of chunk Titanic-4" src="{filename}/figure/Titanic-4-1.png" /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Check the relation between &lt;code&gt;Fare&lt;/code&gt; and &lt;code&gt;Survive&lt;/code&gt;&lt;/strong&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Within the people who survived, higher percentage of them afforded high fare for the ticket, which indicates the high fare may correspond better cabins that are easy to escape from. &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;p3 &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; ggplot&lt;span class="p"&gt;(&lt;/span&gt;train&lt;span class="p"&gt;,&lt;/span&gt; aes&lt;span class="p"&gt;(&lt;/span&gt;x&lt;span class="o"&gt;=&lt;/span&gt;Fare&lt;span class="p"&gt;,&lt;/span&gt; fill&lt;span class="o"&gt;=&lt;/span&gt;Survived&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; geom_histogram&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; 
    facet_grid&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;.&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;Pclass&lt;span class="p"&gt;)&lt;/span&gt;
p3
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="plot of chunk Titanic-5" src="{filename}/figure/Titanic-5-1.png" /&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kp"&gt;prop.table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kp"&gt;table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;train&lt;span class="o"&gt;$&lt;/span&gt;Survived&lt;span class="p"&gt;,&lt;/span&gt; train&lt;span class="o"&gt;$&lt;/span&gt;Pclass&lt;span class="p"&gt;),&lt;/span&gt; margin &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;##    
##             1         2         3
##   0 0.3703704 0.5271739 0.7576375
##   1 0.6296296 0.4728261 0.2423625
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;From the &lt;code&gt;prop.table&lt;/code&gt;, compared to &lt;code&gt;Pclass 2&lt;/code&gt; and &lt;code&gt;Pclass 3&lt;/code&gt;, higher percentage of passenger in &lt;code&gt;Pclass 1&lt;/code&gt; survived.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Check the relation between &lt;code&gt;Embarked&lt;/code&gt; and &lt;code&gt;Survived&lt;/code&gt;&lt;/strong&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;No significant difference between port of embarkation.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;p4 &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; ggplot&lt;span class="p"&gt;(&lt;/span&gt;train&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="kp"&gt;is.na&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;train&lt;span class="o"&gt;$&lt;/span&gt;Embarked&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;],&lt;/span&gt; aes&lt;span class="p"&gt;(&lt;/span&gt;x&lt;span class="o"&gt;=&lt;/span&gt;Survived&lt;span class="p"&gt;,&lt;/span&gt; fill&lt;span class="o"&gt;=&lt;/span&gt;Embarked&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; geom_bar&lt;span class="p"&gt;(&lt;/span&gt;color&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;black&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
p4
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="plot of chunk Titanic-6" src="{filename}/figure/Titanic-6-1.png" /&gt;&lt;/p&gt;
&lt;h2&gt;3. Data Clearing and Feature Engineering&lt;/h2&gt;
&lt;h3&gt;3.1 Feature Engineering&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Name&lt;/code&gt;. Extract the &lt;code&gt;title&lt;/code&gt; and &lt;code&gt;Surname&lt;/code&gt; from &lt;code&gt;Name&lt;/code&gt; and create two new features.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;title.extract &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kr"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;x&lt;span class="p"&gt;){&lt;/span&gt;
    &lt;span class="kp"&gt;strsplit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;x&lt;span class="p"&gt;,&lt;/span&gt; split &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;[,.]&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)[[&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]][&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
combi&lt;span class="o"&gt;$&lt;/span&gt;Title &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kp"&gt;sapply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;Name&lt;span class="p"&gt;,&lt;/span&gt; FUN &lt;span class="o"&gt;=&lt;/span&gt; title.extract&lt;span class="p"&gt;)&lt;/span&gt;
combi&lt;span class="o"&gt;$&lt;/span&gt;Title &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kp"&gt;sub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot; &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; combi&lt;span class="o"&gt;$&lt;/span&gt;Title&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# delete the space in the Title&lt;/span&gt;

&lt;span class="c1"&gt;# combine the similiar into the same category&lt;/span&gt;
combi&lt;span class="o"&gt;$&lt;/span&gt;Title&lt;span class="p"&gt;[&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;PassengerId &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="m"&gt;797&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Mrs&amp;#39;&lt;/span&gt; &lt;span class="c1"&gt;# this passenger is a female doctor&lt;/span&gt;
combi&lt;span class="o"&gt;$&lt;/span&gt;Title&lt;span class="p"&gt;[&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;Title &lt;span class="o"&gt;%in%&lt;/span&gt; &lt;span class="kt"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Mlle&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Mme&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Mlle&amp;#39;&lt;/span&gt;
combi&lt;span class="o"&gt;$&lt;/span&gt;Title&lt;span class="p"&gt;[&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;Title &lt;span class="o"&gt;%in%&lt;/span&gt; &lt;span class="kt"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Capt&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Don&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Major&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Sir&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Jonkheer&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Sir&amp;#39;&lt;/span&gt;
combi&lt;span class="o"&gt;$&lt;/span&gt;Title&lt;span class="p"&gt;[&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;Title &lt;span class="o"&gt;%in%&lt;/span&gt; &lt;span class="kt"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Dona&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Lady&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;the Countess&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;lady&amp;#39;&lt;/span&gt;
combi&lt;span class="o"&gt;$&lt;/span&gt;Title &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kp"&gt;as.factor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;Title&lt;span class="p"&gt;)&lt;/span&gt;

combi&lt;span class="o"&gt;$&lt;/span&gt;Surname &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kp"&gt;sapply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;Name&lt;span class="p"&gt;,&lt;/span&gt; FUN &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kr"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;x&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="kp"&gt;strsplit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;x&lt;span class="p"&gt;,&lt;/span&gt; split&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;[,.]&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)[[&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]][&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]})&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;&lt;code&gt;SibSp&lt;/code&gt; and &lt;code&gt;Parch&lt;/code&gt;. Create a new feature &lt;code&gt;FamilySize&lt;/code&gt; which equals &lt;code&gt;SibSq + Parch +1&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;FamilySize &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; combi&lt;span class="o"&gt;$&lt;/span&gt;SibSp &lt;span class="o"&gt;+&lt;/span&gt; combi&lt;span class="o"&gt;$&lt;/span&gt;Parch &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Base on the two features &lt;code&gt;FamilySize&lt;/code&gt; and &lt;code&gt;Surname&lt;/code&gt;, we create a new feature &lt;code&gt;FamilyID&lt;/code&gt; in order to classify the passengers from the same family into groups. As there are many single passenger whose family is 1, we label these passengers whose &lt;code&gt;FamilySize &amp;lt;=2&lt;/code&gt; as &lt;code&gt;Small&lt;/code&gt;. Note there may be some records whose &lt;code&gt;FamilySize&lt;/code&gt; doesn't equal the frequence of &lt;code&gt;FamilyID&lt;/code&gt;, it's obvious inconformity exists. So we labeled the records where frequence of &lt;code&gt;FamilyID &amp;lt;=2&lt;/code&gt; as &lt;code&gt;Small&lt;/code&gt; as well.  &lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;FamilyID &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kp"&gt;paste&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kp"&gt;as.character&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;FamilySize&lt;span class="p"&gt;),&lt;/span&gt; combi&lt;span class="o"&gt;$&lt;/span&gt;Surname&lt;span class="p"&gt;,&lt;/span&gt; sep &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
combi&lt;span class="o"&gt;$&lt;/span&gt;FamilyID&lt;span class="p"&gt;[&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;FamilySize &lt;span class="o"&gt;&amp;lt;=&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Small&amp;quot;&lt;/span&gt;
famIDs &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kt"&gt;data.frame&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kp"&gt;table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;FamilyID&lt;span class="p"&gt;))&lt;/span&gt;
famIDs &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; famIDs&lt;span class="p"&gt;[&lt;/span&gt;famIDs&lt;span class="o"&gt;$&lt;/span&gt;Freq &lt;span class="o"&gt;&amp;lt;=&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,]&lt;/span&gt; 
&lt;span class="c1"&gt;# if famIDs frequency &amp;lt;=2, regard it as &amp;quot;Small&amp;quot; as well. &lt;/span&gt;
combi&lt;span class="o"&gt;$&lt;/span&gt;FamilyID&lt;span class="p"&gt;[&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;FamilyID &lt;span class="o"&gt;%in%&lt;/span&gt; famIDs&lt;span class="o"&gt;$&lt;/span&gt;Var1 &lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Small&amp;quot;&lt;/span&gt;
combi&lt;span class="o"&gt;$&lt;/span&gt;FamilyID &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kp"&gt;as.factor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;FamilyID&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;For &lt;code&gt;Cabin&lt;/code&gt;, we can extract the first letter of &lt;code&gt;Cabin&lt;/code&gt; as a label. It's obviouse the &lt;code&gt;Cabin&lt;/code&gt; numbers correspond different Passenger Class which is a crucial factor determining whether one could survive. However, since the &lt;code&gt;Cabin&lt;/code&gt; of most records are missing, although the importance of this variable seems to be significant in training, it doesn't increase the predicting score in my models.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# We write a function to extract the first letter of Cabin. A new factor &amp;#39;N&amp;#39; is assigned to the missing values. Also, for the passengers with the same ticket number, the most frequent Cabin level besides &amp;#39;N&amp;#39; is assigned to the rest passengers.&lt;/span&gt;

extractCabin &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kr"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;combi&lt;span class="p"&gt;){&lt;/span&gt;
    &lt;span class="c1"&gt;# extract the first letter of Cabin&lt;/span&gt;
    combi&lt;span class="o"&gt;$&lt;/span&gt;Cabin &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kp"&gt;sapply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;Cabin&lt;span class="p"&gt;,&lt;/span&gt; FUN &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kr"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;x&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="kp"&gt;strsplit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;x&lt;span class="p"&gt;,&lt;/span&gt; split&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[[&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]][&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]})&lt;/span&gt;
    combi&lt;span class="o"&gt;$&lt;/span&gt;Cabin&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="kp"&gt;is.na&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;Cabin&lt;span class="p"&gt;)]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;N&amp;#39;&lt;/span&gt;
    combi&lt;span class="o"&gt;$&lt;/span&gt;Cabin &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kp"&gt;as.factor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;Cabin&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="c1"&gt;# set the same number tickets with the same Cabin label&lt;/span&gt;
    combi.ticket &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kp"&gt;table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kp"&gt;factor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;Ticket&lt;span class="p"&gt;))&lt;/span&gt;
    combi.ticket.moreThanOne &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; combi.ticket&lt;span class="p"&gt;[&lt;/span&gt;combi.ticket&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    combi.temp &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; combi&lt;span class="p"&gt;[&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;Ticket &lt;span class="o"&gt;%in%&lt;/span&gt; &lt;span class="kp"&gt;names&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;combi.ticket.moreThanOne&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="kr"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;name &lt;span class="kr"&gt;in&lt;/span&gt; &lt;span class="kp"&gt;names&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;combi.ticket.moreThanOne&lt;span class="p"&gt;)){&lt;/span&gt;
        row.sameTicket &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; combi&lt;span class="p"&gt;[&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;Ticket &lt;span class="o"&gt;==&lt;/span&gt; name&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
        Cabin_boolean &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; row.sameTicket&lt;span class="o"&gt;$&lt;/span&gt;Cabin &lt;span class="o"&gt;%in%&lt;/span&gt; &lt;span class="kt"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;C&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;D&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;E&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;F&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;G&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="kr"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kp"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;Cabin_boolean&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
            correctCabin &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kp"&gt;names&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kp"&gt;sort&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kp"&gt;table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;row.sameTicket&lt;span class="o"&gt;$&lt;/span&gt;Cabin&lt;span class="p"&gt;[&lt;/span&gt;Cabin_boolean&lt;span class="p"&gt;]),&lt;/span&gt; decreasing&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;))[&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
            row.sameTicket&lt;span class="o"&gt;$&lt;/span&gt;Cabin&lt;span class="p"&gt;[&lt;/span&gt;row.sameTicket&lt;span class="o"&gt;$&lt;/span&gt;Cabin &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;N&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; correctCabin
            &lt;span class="c1"&gt;# modify the Cabin of combi dataset&lt;/span&gt;
            combi&lt;span class="o"&gt;$&lt;/span&gt;Cabin&lt;span class="p"&gt;[&lt;/span&gt;row.sameTicket&lt;span class="o"&gt;$&lt;/span&gt;PassengerId&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; row.sameTicket&lt;span class="o"&gt;$&lt;/span&gt;Cabin
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    combi&lt;span class="o"&gt;$&lt;/span&gt;Cabin &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kp"&gt;as.factor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;Cabin&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="kr"&gt;return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;combi&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
combi &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; extractCabin&lt;span class="p"&gt;(&lt;/span&gt;combi&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;For &lt;code&gt;Ticket&lt;/code&gt;, we extracted the first alphabet character of &lt;code&gt;Ticket&lt;/code&gt; to label the ticket.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;extractTicket &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kr"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;ticket&lt;span class="p"&gt;){&lt;/span&gt;
    pattern &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kt"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;\\/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;\\.&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;\\s&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;[[:digit:]]&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="kr"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;p &lt;span class="kr"&gt;in&lt;/span&gt; pattern&lt;span class="p"&gt;){&lt;/span&gt;
        &lt;span class="c1"&gt;# replace all chracter matches the pattern p with &amp;quot;&amp;quot;&lt;/span&gt;
        ticket &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kp"&gt;gsub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;p&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; ticket&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    ticket &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kp"&gt;substr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kp"&gt;toupper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;ticket&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# only extract the first alphabet character to label the ticket&lt;/span&gt;
    ticket&lt;span class="p"&gt;[&lt;/span&gt;ticket&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;N&amp;#39;&lt;/span&gt;
    ticket &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kp"&gt;as.factor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;ticket&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
combi&lt;span class="o"&gt;$&lt;/span&gt;Ticket &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; extractTicket&lt;span class="p"&gt;(&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;Ticket&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;3.2 Dealing with missing values&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Fare&lt;/code&gt;. Replace the NA in &lt;code&gt;Fare&lt;/code&gt; with the median of &lt;code&gt;Fare&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;Fare&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="kp"&gt;is.na&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;Fare&lt;span class="p"&gt;)]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; median&lt;span class="p"&gt;(&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;Fare&lt;span class="p"&gt;,&lt;/span&gt; na.rm &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Embarked&lt;/code&gt;. Replase the NA in &lt;code&gt;Embarked&lt;/code&gt; with the most frequent label &lt;code&gt;S&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;Embarked&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="kp"&gt;is.na&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;Embarked&lt;span class="p"&gt;)]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;S&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Age&lt;/code&gt;. We fill out the NA in &lt;code&gt;Age&lt;/code&gt; by fitting a decision tree, which uses the features exclude &lt;code&gt;Survived&lt;/code&gt; to predict &lt;code&gt;Age&lt;/code&gt;. Here we just use the default parameters of &lt;code&gt;rpart&lt;/code&gt;, for more details, check &lt;code&gt;rpart.control&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;rpart&lt;span class="p"&gt;)&lt;/span&gt;
Agefit &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; rpart&lt;span class="p"&gt;(&lt;/span&gt;Age &lt;span class="o"&gt;~&lt;/span&gt; Pclass &lt;span class="o"&gt;+&lt;/span&gt; Sex &lt;span class="o"&gt;+&lt;/span&gt; SibSp &lt;span class="o"&gt;+&lt;/span&gt; Parch &lt;span class="o"&gt;+&lt;/span&gt; Fare &lt;span class="o"&gt;+&lt;/span&gt; Embarked &lt;span class="o"&gt;+&lt;/span&gt; Title &lt;span class="o"&gt;+&lt;/span&gt; FamilySize&lt;span class="p"&gt;,&lt;/span&gt;
                data &lt;span class="o"&gt;=&lt;/span&gt; combi&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="kp"&gt;is.na&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;Age&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;],&lt;/span&gt; method &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;anova&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
combi&lt;span class="o"&gt;$&lt;/span&gt;Age&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="kp"&gt;is.na&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;Age&lt;span class="p"&gt;)]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; predict&lt;span class="p"&gt;(&lt;/span&gt;Agefit&lt;span class="p"&gt;,&lt;/span&gt; combi&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="kp"&gt;is.na&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;combi&lt;span class="o"&gt;$&lt;/span&gt;Age&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;4. Fitting Models&lt;/h2&gt;
&lt;p&gt;Write a function to extract features from dataset. As the dataset is small and many missing values in &lt;code&gt;Cabin&lt;/code&gt; and &lt;code&gt;Ticket&lt;/code&gt;, these two features actually don't increase the predicting score so I didn't included them in my models. &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;train &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; combi&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="kp"&gt;nrow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;train&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
test &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; combi&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="kp"&gt;nrow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;train&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="m"&gt;+1&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;nrow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;test&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;

extractFeatures &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kr"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;data&lt;span class="p"&gt;){&lt;/span&gt;
    features &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kt"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Pclass&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                  &lt;span class="s"&gt;&amp;#39;Sex&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                  &lt;span class="s"&gt;&amp;#39;Age&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                  &lt;span class="s"&gt;&amp;#39;SibSp&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                  &lt;span class="s"&gt;&amp;#39;Parch&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                  &lt;span class="s"&gt;&amp;#39;Fare&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                  &lt;span class="c1"&gt;#&amp;#39;Cabin&amp;#39;,&lt;/span&gt;
                  &lt;span class="s"&gt;&amp;#39;Embarked&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                  &lt;span class="s"&gt;&amp;#39;Survived&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                  &lt;span class="s"&gt;&amp;#39;Title&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                  &lt;span class="s"&gt;&amp;#39;FamilySize&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                  &lt;span class="s"&gt;&amp;#39;FamilyID&amp;#39;&lt;/span&gt;
                  &lt;span class="c1"&gt;#&amp;#39;Ticket&amp;#39;&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
    fea &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; data&lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="p"&gt;,&lt;/span&gt; features&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="kr"&gt;return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;fea&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;4.1 Logistic regression (Ridge)&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;glmnet&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# create a sparse matrix of the dataset but column Survived. This is converting categorical variables into dummies variables.&lt;/span&gt;
x &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; model.matrix&lt;span class="p"&gt;(&lt;/span&gt;Survived&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="m"&gt;.&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; data &lt;span class="o"&gt;=&lt;/span&gt; extractFeatures&lt;span class="p"&gt;(&lt;/span&gt;train&lt;span class="p"&gt;))&lt;/span&gt;
y &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; extractFeatures&lt;span class="p"&gt;(&lt;/span&gt;train&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;Survived
newx &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; model.matrix&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="m"&gt;.&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; data &lt;span class="o"&gt;=&lt;/span&gt; extractFeatures&lt;span class="p"&gt;(&lt;/span&gt;test&lt;span class="p"&gt;)[,&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="kp"&gt;which&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kp"&gt;names&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;extractFeatures&lt;span class="p"&gt;(&lt;/span&gt;test&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="o"&gt;%in%&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;Survived&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)])&lt;/span&gt;

&lt;span class="kp"&gt;set.seed&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
fit_ridge &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; cv.glmnet&lt;span class="p"&gt;(&lt;/span&gt;x&lt;span class="p"&gt;,&lt;/span&gt; y&lt;span class="p"&gt;,&lt;/span&gt; alpha &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; family &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;binomial&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; type.measure &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;deviance&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
pred_ridge &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; predict&lt;span class="p"&gt;(&lt;/span&gt;fit_ridge&lt;span class="p"&gt;,&lt;/span&gt; newx &lt;span class="o"&gt;=&lt;/span&gt; newx&lt;span class="p"&gt;,&lt;/span&gt; s &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;lambda.min&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; type&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;class&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

submission &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kt"&gt;data.frame&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;PassengerId &lt;span class="o"&gt;=&lt;/span&gt; test&lt;span class="o"&gt;$&lt;/span&gt;PassengerId&lt;span class="p"&gt;,&lt;/span&gt; Survived &lt;span class="o"&gt;=&lt;/span&gt; pred_ridge&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;#write.csv(submission, file = &amp;quot;ridge.csv&amp;quot;, row.names=FALSE) &lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The &lt;code&gt;glmnet&lt;/code&gt; package can fit &lt;code&gt;lasso&lt;/code&gt;, &lt;code&gt;ridge&lt;/code&gt; and &lt;code&gt;elasticnet&lt;/code&gt;. Here we just fit &lt;code&gt;ridge&lt;/code&gt; which performs a little bit better than &lt;code&gt;lasso&lt;/code&gt; in this dataset. &lt;/p&gt;
&lt;p&gt;The submitted score is 0.80861.&lt;/p&gt;
&lt;p&gt;Actually if you set &lt;code&gt;set.seed(1)&lt;/code&gt;, and use misclassification error as metric (set &lt;code&gt;type.measure = 'class'&lt;/code&gt;), the submitted score can be as high as 0.82297. However, it seems the result of this metric isn't as stable as deviance.&lt;/p&gt;
&lt;h3&gt;4.2 Gradient boosting machine&lt;/h3&gt;
&lt;p&gt;Here we directly use &lt;code&gt;Caret&lt;/code&gt; to fit the gradient boosting machine and tune parameters. Through &lt;code&gt;Caret&lt;/code&gt;, there are four parameters can be tuned.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;n.trees&lt;/code&gt;, the number of iterations (trees) in the model.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;interaction.depth&lt;/code&gt;, the numbers of splits it has to perform on a tree, so it equals &lt;code&gt;NumberOfLeaves + 1&lt;/code&gt;. &lt;strong&gt;Note:&lt;/strong&gt; the interaction in &lt;code&gt;interaction.depth&lt;/code&gt; is defferent from the usual understanding which is the interaction of features, e.g. feature x has two levels A and B, feature y has two levels C and D, then the interaction of x and y has four levels.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;shrinkage&lt;/code&gt;, knows as learning rate, the empact of each tree on the final model. Lower learning rate requires more iterations.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;n.minobsinnode&lt;/code&gt;, minimum number of observations in the trees terminal nodes. The default value is 10.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For other parameters, like &lt;code&gt;bag.fraction&lt;/code&gt;, cannot be tuned via &lt;code&gt;Caret&lt;/code&gt;. You can write your function to tune it. &lt;/p&gt;
&lt;p&gt;For the precedures of tuning GBM parameters in Python, see a blog &lt;a href="https://www.analyticsvidhya.com/blog/2016/02/complete-guide-parameter-tuning-gradient-boosting-gbm-python/"&gt;here&lt;/a&gt;. The parameters of GBM in R is slightly different from the one in Python, but the experience of tuning is consistent.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;caret&lt;span class="p"&gt;)&lt;/span&gt;

fitControl &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; trainControl&lt;span class="p"&gt;(&lt;/span&gt;method &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;repeatedcv&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                           number &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                           repeats &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# for caret, there are only four tuning parameters below.&lt;/span&gt;

&lt;span class="c1"&gt;# tune n.trees&lt;/span&gt;
newGrid &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kp"&gt;expand.grid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;n.trees &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kt"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;50&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="m"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="m"&gt;200&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="m"&gt;300&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; 
                       interaction.depth &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kt"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;6&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
                       shrinkage &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0.01&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                       n.minobsinnode &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;10&lt;/span&gt;
                       &lt;span class="p"&gt;)&lt;/span&gt;
fit_gbm &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; train&lt;span class="p"&gt;(&lt;/span&gt;Survived &lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="m"&gt;.&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; data&lt;span class="o"&gt;=&lt;/span&gt;extractFeatures&lt;span class="p"&gt;(&lt;/span&gt;train&lt;span class="p"&gt;),&lt;/span&gt; 
                 method &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;gbm&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; 
                 trControl &lt;span class="o"&gt;=&lt;/span&gt; fitControl&lt;span class="p"&gt;,&lt;/span&gt;
                 tuneGrid &lt;span class="o"&gt;=&lt;/span&gt;  newGrid&lt;span class="p"&gt;,&lt;/span&gt;
                 bag.fraction &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                 verbose &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;FALSE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
fit_gbm&lt;span class="o"&gt;$&lt;/span&gt;bestTune
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;##   n.trees interaction.depth shrinkage n.minobsinnode
## 3     200                 6      0.01             10
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# tune interaction.depth&lt;/span&gt;
&lt;span class="kp"&gt;set.seed&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1234&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
newGrid &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kp"&gt;expand.grid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;n.trees &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kt"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;200&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; 
                       interaction.depth &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kt"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="m"&gt;12&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
                       shrinkage &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0.01&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                       n.minobsinnode &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;10&lt;/span&gt;
                       &lt;span class="p"&gt;)&lt;/span&gt;
fit_gbm &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; train&lt;span class="p"&gt;(&lt;/span&gt;Survived &lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="m"&gt;.&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; data&lt;span class="o"&gt;=&lt;/span&gt;extractFeatures&lt;span class="p"&gt;(&lt;/span&gt;train&lt;span class="p"&gt;),&lt;/span&gt; 
                 method &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;gbm&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; 
                 trControl &lt;span class="o"&gt;=&lt;/span&gt; fitControl&lt;span class="p"&gt;,&lt;/span&gt;
                 tuneGrid &lt;span class="o"&gt;=&lt;/span&gt;  newGrid&lt;span class="p"&gt;,&lt;/span&gt;
                 bag.fraction &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                 verbose &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;FALSE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
fit_gbm&lt;span class="o"&gt;$&lt;/span&gt;bestTune
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;##   n.trees interaction.depth shrinkage n.minobsinnode
## 7     200                10      0.01             10
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# decrease learning rate&lt;/span&gt;
&lt;span class="kp"&gt;set.seed&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1234&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
newGrid &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kp"&gt;expand.grid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;n.trees &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kt"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;2000&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; 
                       interaction.depth &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kt"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
                       shrinkage &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0.001&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                       n.minobsinnode &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;10&lt;/span&gt;
                       &lt;span class="p"&gt;)&lt;/span&gt;
fit_gbm_LowerRate &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; train&lt;span class="p"&gt;(&lt;/span&gt;Survived &lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="m"&gt;.&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; data&lt;span class="o"&gt;=&lt;/span&gt;extractFeatures&lt;span class="p"&gt;(&lt;/span&gt;train&lt;span class="p"&gt;),&lt;/span&gt; 
                 method &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;gbm&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; 
                 trControl &lt;span class="o"&gt;=&lt;/span&gt; fitControl&lt;span class="p"&gt;,&lt;/span&gt;
                 tuneGrid &lt;span class="o"&gt;=&lt;/span&gt;  newGrid&lt;span class="p"&gt;,&lt;/span&gt;
                 bag.fraction &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                 verbose &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;FALSE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
fit_gbm_LowerRate&lt;span class="o"&gt;$&lt;/span&gt;results
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;##   n.trees interaction.depth shrinkage n.minobsinnode  Accuracy    Kappa
## 1    2000                10     0.001             10 0.8241676 0.618902
##   AccuracySD  KappaSD
## 1 0.03510324 0.072976
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# predict &lt;/span&gt;
pred_gbm &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; predict&lt;span class="p"&gt;(&lt;/span&gt;fit_gbm_LowerRate&lt;span class="p"&gt;,&lt;/span&gt; extractFeatures&lt;span class="p"&gt;(&lt;/span&gt;test&lt;span class="p"&gt;))&lt;/span&gt;
submission &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kt"&gt;data.frame&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;PassengerId &lt;span class="o"&gt;=&lt;/span&gt; test&lt;span class="o"&gt;$&lt;/span&gt;PassengerId&lt;span class="p"&gt;,&lt;/span&gt; Survived &lt;span class="o"&gt;=&lt;/span&gt; pred_gbm&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;#write.csv(submission, file = &amp;quot;gbm_ntree-2000_rate-0.001_inter-10.csv&amp;quot;, row.names=FALSE)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The submitted score is 0.81340. As the size of data set is small, it seems the result of GBM isn't very stable for different random seed. &lt;/p&gt;
&lt;h3&gt;4.3 Random forest&lt;/h3&gt;
&lt;p&gt;This article is inspired by the excellent tutorial of &lt;a href="http://trevorstephens.com/kaggle-titanic-tutorial/getting-started-with-r/"&gt;Trevor Stephens&lt;/a&gt;, in which a conditional random forest is implemented to achieve the score of 0.81340. Here I just repeat this model.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;party&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="kp"&gt;set.seed&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
fit_crf &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; cforest&lt;span class="p"&gt;(&lt;/span&gt;Survived &lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="m"&gt;.&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; data&lt;span class="o"&gt;=&lt;/span&gt;extractFeatures&lt;span class="p"&gt;(&lt;/span&gt;train&lt;span class="p"&gt;),&lt;/span&gt; controls&lt;span class="o"&gt;=&lt;/span&gt;cforest_unbiased&lt;span class="p"&gt;(&lt;/span&gt;ntree&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;2000&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; mtry&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
pred_crf &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; predict&lt;span class="p"&gt;(&lt;/span&gt;fit_crf&lt;span class="p"&gt;,&lt;/span&gt; extractFeatures&lt;span class="p"&gt;(&lt;/span&gt;test&lt;span class="p"&gt;),&lt;/span&gt; OOB &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; type&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;response&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

submission &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kt"&gt;data.frame&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;PassengerId &lt;span class="o"&gt;=&lt;/span&gt; test&lt;span class="o"&gt;$&lt;/span&gt;PassengerId&lt;span class="p"&gt;,&lt;/span&gt; Survived &lt;span class="o"&gt;=&lt;/span&gt; pred_crf&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;#write.csv(submission, file = &amp;quot;crf_seed1.csv&amp;quot;, row.names=FALSE)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The &lt;code&gt;ntree&lt;/code&gt; is the number of trees in the random forest model, the &lt;code&gt;mtry&lt;/code&gt; is the number of input variables randomly sampled as candidate at each node. The rule-of-thumb is &lt;code&gt;sqrt(p)&lt;/code&gt; where &lt;code&gt;p&lt;/code&gt; is the number of features, as we only included 10 features in our model, so we set &lt;code&gt;mtry=3&lt;/code&gt;. For more details of conditional random forest, check &lt;code&gt;help(ctree_contorl)&lt;/code&gt; in R. For the comparison between conditional inference trees and traditional decision trees, check the question in &lt;a href="http://stats.stackexchange.com/questions/12140/conditional-inference-trees-vs-traditional-decision-trees"&gt;StackExchange&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The submitted score is 0.81340.&lt;/p&gt;
&lt;h3&gt;4.4. Ensemble&lt;/h3&gt;
&lt;p&gt;Ensemble is a effective way to combine the models to reduce the overall error rate. In one word, extracting the pattern discovered by each model and ensembling them could achieve a better score. Therefore, ensembling the uncorrelated results of models may do better since each model contain different patterns. For the detailed introduction of ensembling experiences, check this fantastic &lt;a href="http://mlwave.com/kaggle-ensembling-guide/"&gt;blog&lt;/a&gt;. &lt;/p&gt;
&lt;p&gt;Here we just do the simple majority vote.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kp"&gt;cat&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Difference ratio between ridge and conditional random forest:&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kp"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;pred_ridge&lt;span class="o"&gt;!=&lt;/span&gt;pred_crf&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="kp"&gt;nrow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;test&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;## Difference ratio between ridge and conditional random forest: 0.06698565
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kp"&gt;cat&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Difference ratio between ridge and conditional gbm:&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kp"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;pred_ridge&lt;span class="o"&gt;!=&lt;/span&gt;pred_gbm&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="kp"&gt;nrow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;test&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;## Difference ratio between ridge and conditional gbm: 0.0861244
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kp"&gt;cat&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Difference ratio between conditional random forest and gbm:&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kp"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;pred_crf&lt;span class="o"&gt;!=&lt;/span&gt;pred_gbm&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="kp"&gt;nrow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;test&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;## Difference ratio between conditional random forest and gbm: 0.0430622
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ensemble &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kp"&gt;as.numeric&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;pred_ridge&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="kp"&gt;as.numeric&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;pred_gbm&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="m"&gt;-1&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="kp"&gt;as.numeric&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;pred_crf&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="m"&gt;-1&lt;/span&gt;
ensemble &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kp"&gt;sapply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;ensemble&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kp"&gt;round&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

submission &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="kt"&gt;data.frame&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;PassengerId &lt;span class="o"&gt;=&lt;/span&gt; test&lt;span class="o"&gt;$&lt;/span&gt;PassengerId&lt;span class="p"&gt;,&lt;/span&gt; Survived &lt;span class="o"&gt;=&lt;/span&gt; ensemble&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;#write.csv(submission, file = &amp;quot;ensemble_vote2.csv&amp;quot;, row.names=FALSE)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The submitted score is 0.82297.&lt;/p&gt;
&lt;h2&gt;5. Summary&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Logistic regression&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The &lt;code&gt;glmnet&lt;/code&gt; in R and logistic regression with l1 and l2 penalty in python sklearn are different. The cost function is different, sklearn regularize intercept while glmnet doesn't. See &lt;a href="http://stats.stackexchange.com/questions/203816/logistic-regression-scikit-learn-vs-glmnet"&gt;stackexchange&lt;/a&gt; as reference.&lt;/li&gt;
&lt;li&gt;In &lt;code&gt;glmnet&lt;/code&gt;, before fitting the model, the data should be converted into sparse matrix(encode categorical variable into dummy variable). By default &lt;code&gt;glmnet&lt;/code&gt; standardize the input by default, including the dummy variables. According to the Tibshirani's &lt;a href="http://statweb.stanford.edu/~tibs/lasso/fulltext.pdf"&gt;article&lt;/a&gt;:&lt;ul&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;The lasso method requires initial standardization of the regressors, so that the penalization scheme is fair to all regressors. For categorical regressors, one codes the regressor with dummy variables and then standardizes the dummy variables. As pointed out by a referee, however, the relative scaling between continuous and categorical variables in this scheme can be somewhat arbitrary.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;When tuning the regularization parameter $\lambda$ via &lt;code&gt;cv.glmnet&lt;/code&gt;, &lt;code&gt;glmnet&lt;/code&gt; called one hundred values of lambda and choose the one which achieve lowest error. However for logistic regression in sklearn, a sequence of tuning parameter &lt;code&gt;C&lt;/code&gt; need be specified for tuning. As a result, logistic regression in sklearn can hardly performs as good as &lt;code&gt;glmnet&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Gradient boosting&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Since the dataset is small, the performance of boosting machine isn't stable. This brings difficulty in tuning the parameters. Although some parameter combinations perform good through cross-validation on training set, they still overfit the test set.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Ensemble&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The ensemble method like stacking and blending may achieve better results, which could be the next step to tweak the model.&lt;/li&gt;
&lt;/ul&gt;</summary></entry></feed>